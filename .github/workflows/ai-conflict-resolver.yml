name: AI Conflict Resolver (Puter.js Powered)

# Automated conflict detection and resolution using puter.js - NO Google dependencies!
on:
  issues:
    types: [opened, edited, commented, labeled]
  pull_request:
    types: [opened, edited, synchronize, reopened]
  issue_comment:
    types: [created, edited]

permissions:
  contents: read
  issues: write
  pull-requests: write
  id-token: write

env:
  PUTER_CLIENT_ENABLED: true
  FEAT_PUTER: true

jobs:
  ai-conflict-resolver:
    runs-on: ubuntu-latest
    environment: production
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js 18.x
        uses: actions/setup-node@v4
        with:
          node-version: "18"

      - name: Install puter.js dependencies
        run: |
          npm install --no-package-lock
          # Ensure node-fetch is available for puter integration
          npm install node-fetch@2.7.0 --no-save

      - name: Run Puter.js AI Conflict Resolution Analysis
        id: puter_conflict_analysis
        env:
          PUTER_CLIENT_ENABLED: ${{ env.PUTER_CLIENT_ENABLED }}
          FEAT_PUTER: ${{ env.FEAT_PUTER }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GITHUB_EVENT_PATH: ${{ github.event_path }}
          GITHUB_REPOSITORY: ${{ github.repository }}
          GITHUB_EVENT_NAME: ${{ github.event_name }}
        run: |
          echo "ðŸš€ Starting Puter.js AI Conflict Resolution System v2.0"
          echo "âœ… Google/Gemini dependencies removed - using puter.js instead!"
          
          # Make script executable
          chmod +x scripts/puter/conflict-resolution/puter-conflict-resolver.js
          
          # Run the puter.js-powered conflict resolver
          node scripts/puter/conflict-resolution/puter-conflict-resolver.js

      - name: Upload puter.js conflict resolution artifact
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: puter-ai-conflict-resolution-${{ github.run_number }}
          path: ./artifacts/puter-conflict-resolution-*.json
